"""
Copyright (c) 2023 Kayque Silva Della Capa

A permissão é concedida, gratuitamente, a qualquer pessoa que obtenha uma cópia
deste software e arquivos de documentação associados (o "Software"), para lidar
com o Software sem restrições, incluindo, sem limitação, os direitos
de usar, copiar, modificar, mesclar, publicar, distribuir, sublicenciar e/ou vender
cópias do Software, e permitir que pessoas a quem o Software é
fornecido o façam, sujeito às seguintes condições:

O aviso de direitos autorais acima e este aviso de permissão devem ser incluídos em todas
cópias ou partes substanciais do Software.

O SOFTWARE É FORNECIDO "COMO ESTÁ", SEM GARANTIA DE QUALQUER TIPO, EXPRESSA OU
IMPLÍCITA, INCLUINDO, MAS NÃO SE LIMITANDO ÀS GARANTIAS DE COMERCIALIZAÇÃO,
ADEQUAÇÃO A UM PROPÓSITO ESPECÍFICO E NÃO VIOLAÇÃO. EM NENHUM CASO OS
AUTORES OU DETENTORES DE DIREITOS AUTORAIS SERÃO RESPONSÁVEIS POR QUALQUER RECLAMAÇÃO,
DANOS OU OUTRA RESPONSABILIDADE, SEJA EM AÇÃO DE CONTRATO, DELITO OU DE OUTRA FORMA,
DECORRENTE DE, OU EM CONEXÃO COM O SOFTWARE OU O USO OU OUTRAS NEGOCIAÇÕES NO
SOFTWARE.
"""

import pandas as pd
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
import smtplib
from getpass import getpass 

clients = pd.read_excel('.\clientes2.xlsx')

def manipular_planilha(caminho_planilha):
    df = pd.read_excel(caminho_planilha)
    df.to_excel(caminho_planilha, index=False)

def enviar_email(client, subject, email_body, email, senha):
    msg = MIMEMultipart()
    msg['Subject'] = subject
    msg['From'] = email
    msg['To'] = client['email']
    msg.attach(MIMEText(email_body, 'plain'))

    try:
        server = smtplib.SMTP('smtp.gmail.com', port=587)
        server.starttls()
        server.login(email, senha)
        server.sendmail(msg['From'], msg['To'], msg.as_string())
        print(f'O e-mail foi enviado com sucesso para {client["nome"]}')
    except Exception as e:
        print(f'Erro ao enviar o e-mail para {client["nome"]}: {str(e)}')
    finally:
        server.quit()

def main():
    caminho_planilha = '.\\clientes2.xlsx'

    manipular_planilha(caminho_planilha)

    email = input("Digite seu e-mail: ")
    senha = getpass("Digite sua senha: ") 

    subject = input("Digite o assunto do e-mail: ")
    email_body = input("Digite o corpo do e-mail: ")

    clients = pd.read_excel(caminho_planilha)

    for index, client in clients.iterrows():
        if pd.notna(client['email']):
            enviar_email(client, subject, email_body, email, senha)

if __name__ == "__main__":
    main()


